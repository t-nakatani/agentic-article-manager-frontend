# Theme System Design Document

## Overview
テーマシステムは、記事を階層的に分類・管理するための機能を提供します。ユーザーは直感的なインターフェースを通じてテーマを作成、編集、整理することができます。

## Core Concepts

### Theme Hierarchy
- ルートレベルに "すべて" ノードが存在
- 無制限の階層深度をサポート
- 各テーマは複数の子テーマを持つことが可能
- テーマは一意のIDと表示名を持つ

### Theme Operations
1. 作成
   - 新規テーマの追加（親テーマの指定可能）
   - デフォルトラベル "新しいテーマ" で作成
   - 作成直後に編集モードを自動起動

2. 編集
   - テーマ名の変更
   - ダブルクリックで編集モード開始
   - Enterで保存、Escapeでキャンセル

3. 移動
   - ドラッグ＆ドロップによる階層構造の変更
   - 視覚的なフィードバックを提供
   - 無効な移動（循環参照など）を防止

4. 削除
   - テーマの削除（確認ダイアログあり）
   - 子テーマの扱いを選択可能（削除/親テーマに移動）

## Data Structure

### Theme Node
- id: string（一意の識別子）
- label: string（表示名）
- children?: ThemeNode[]（子テーマ）
- isNewNode?: boolean（新規作成フラグ）
- parentId?: string（親テーマID）

### Theme Tree
階層構造を表現するためのデータ構造：
- ルートノード（"すべて"）を頂点とする木構造
- 各ノードは0個以上の子ノードを持つ
- 循環参照は禁止

## Components

### ThemeTree
テーマツリー全体を管理する主要コンポーネント
- テーマの階層表示
- 展開/折りたたみ制御
- テーマ選択機能
- 編集モード制御

### TreeNode
個別のテーマノードを表示するコンポーネント
- ラベル表示/編集
- 展開状態の制御
- 子ノードの表示
- コンテキストメニュー

### ThemeBoard
テーマの視覚的な編集を行うコンポーネント
- ノードの配置と接続を管理
- ドラッグ＆ドロップ操作
- 変更の保存機能

## State Management

### ThemeContext
グローバルなテーマ状態を管理
- テーマツリーのデータ
- 選択中のテーマ
- 編集状態
- APIとの同期

### Local State
コンポーネント固有の状態管理
- 展開/折りたたみ状態
- 編集モード
- ドラッグ＆ドロップ状態

## API Integration

### Theme API
バックエンドとの通信を担当
- テーマの取得
- テーマの作成/更新/削除
- 階層構造の更新

### Error Handling
- API通信エラーの処理
- ユーザーへのフィードバック
- 楽観的更新のロールバック

## Modes

### Normal Mode
- フル機能を利用可能
- ログインユーザー向け
- すべての操作が可能

### Demo Mode
- 読み取り専用
- 未ログインユーザー向け
- 編集機能を制限

## Future Considerations

### Performance
- 大規模テーマツリーの最適化
- 遅延読み込みの実装
- メモ化の活用

### Features
- テーマの検索機能
- キーボードナビゲーション
- テーマのインポート/エクスポート
- テーマの統計情報表示

### UI/UX
- テーマカラーのカスタマイズ
- ドラッグ＆ドロップのアニメーション改善
- モバイル対応の強化

### Integration
- 外部システムとの連携
- APIの拡張
- バッチ処理のサポート
</Thinking>

