# Redux Toolkit導入戦略

## 背景

現在のアプリケーションでは、状態管理が分散しており、以下の問題が発生しています：

- 状態管理の分散と断片化
- データフローの複雑さとprops drilling
- 非同期処理と状態更新の連携の複雑さ
- 状態更新の一貫性の欠如
- キャッシュ戦略の欠如
- 状態の永続化の限定的な実装

これらの問題を解決するために、Redux Toolkitを導入し、状態管理を一元化します。

## 戦略：段階的移行アプローチ

Redux Toolkitへの移行は大規模なリファクタリングになりますが、「小さく始めて徐々に拡大する」アプローチを取ることで、常に動作する状態を維持しながら進めることができます。

### 1. 全体的な移行計画

1. **準備フェーズ**: Redux Toolkit導入と基本設定
2. **第1フェーズ**: 独立した機能から移行開始（記事の並び替え・フィルタリング）
3. **第2フェーズ**: 中核機能の移行（記事データ管理）
4. **第3フェーズ**: 複雑な機能の移行（テーマ管理）
5. **第4フェーズ**: 認証関連の移行（最も影響範囲が広いため最後に）
6. **最適化フェーズ**: パフォーマンス改善とコード整理

## 戦術：具体的な実装ステップ

### 準備フェーズ: Redux Toolkit導入と基本設定

1. **依存関係のインストール**
   - @reduxjs/toolkit と react-redux パッケージをインストール

2. **Reduxストアの基本設定**
   - configureStore を使用してストアを作成
   - 空のレデューサーから始める
   - RootStateとAppDispatchの型を定義

3. **Providerの設定**
   - 既存のコンテキストと並行してRedux Providerを設定
   - RootLayoutコンポーネントを修正

4. **型定義とフック設定**
   - TypedUseSelectorHook、useDispatch、useSelectorの設定
   - useAppDispatchとuseAppSelectorのカスタムフックを作成

### 第1フェーズ: 独立した機能から移行開始

1. **記事の並び替え・フィルタリング状態をReduxに移行**
   - articleFiltersSliceを作成
   - sortField、sortDirection、searchQuery、selectedThemeの状態を管理
   - 対応するアクションを定義

2. **ストアにリデューサーを追加**
   - articleFiltersReducerをストアに追加

3. **コンポーネントでReduxを使用**
   - 既存のpropsと並行してReduxの状態とアクションを使用
   - 段階的に移行

### 第2フェーズ: 記事データ管理の移行

1. **記事データ用のスライスを作成**
   - articlesSliceを作成
   - 記事の取得、削除などの非同期アクションを定義
   - ローディング状態とエラー状態の管理

2. **ストアにリデューサーを追加**
   - articlesReducerをストアに追加

3. **カスタムフックを作成して移行を容易に**
   - useReduxArticlesフックを作成
   - 既存のuseArticlesフックと同様のインターフェースを提供

4. **既存のフックを徐々に置き換え**
   - 既存のuseArticlesフックをuseReduxArticlesに置き換え

### 第3フェーズ: テーマ管理の移行

1. **テーマ管理用のスライスを作成**
   - themesSliceを作成
   - テーマの階層構造を管理
   - テーマの追加、更新、削除などのアクションを定義

2. **ストアにリデューサーを追加**
   - themesReducerをストアに追加

3. **カスタムフックを作成**
   - useReduxThemesフックを作成
   - 既存のuseThemeフックと同様のインターフェースを提供

4. **ThemeContextからReduxへの移行**
   - ThemeContextの参照を徐々にReduxに置き換え

### 第4フェーズ: 認証関連の移行

1. **認証用のスライスを作成**
   - authSliceを作成
   - ユーザー情報、認証状態、ログイン/ログアウト機能を管理

2. **ストアにリデューサーを追加**
   - authReducerをストアに追加

3. **Firebase認証との連携**
   - Firebaseの認証状態をReduxに同期するミドルウェアを作成

4. **AuthContextからReduxへの移行**
   - AuthContextの参照を徐々にReduxに置き換え

## 実装の優先順位と注意点

### 優先順位

1. **最も独立した機能から**: 記事のフィルタリング・ソート機能
2. **次に中核機能**: 記事データの取得・管理
3. **複雑な機能**: テーマ管理
4. **最後に広範囲に影響する機能**: 認証関連

### 注意点

1. **段階的に移行する**: 一度にすべてを変更せず、機能ごとに移行
2. **並行運用期間を設ける**: 新旧の状態管理を一時的に共存させる
3. **テストを充実させる**: 各段階でテストを行い、機能が正常に動作することを確認
4. **コミットを小さく保つ**: 各機能の移行ごとにコミットし、問題が発生した場合に戻しやすくする
5. **ドキュメントを更新**: 新しい状態管理の使い方を文書化する

## 移行完了後の最適化

1. **不要になったコンテキストやフックの削除**
2. **セレクターの最適化**: メモ化されたセレクターの導入
3. **Redux DevToolsの活用**: デバッグ体験の向上
4. **永続化の導入**: redux-persistを使用した状態の永続化

## リソース

- Redux Toolkit公式ドキュメント: https://redux-toolkit.js.org/
- React Redux公式ドキュメント: https://react-redux.js.org/
- Redux DevTools: https://github.com/reduxjs/redux-devtools

## ディレクトリ構造

